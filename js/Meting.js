class MetingJSElement extends HTMLElement{connectedCallback(){window.APlayer&&window.fetch&&(this._init(),this._parse())}disconnectedCallback(){this.lock||this.aplayer.destroy()}_camelize(e){return e.replace(/^[_.\- ]+/,"").toLowerCase().replace(/[_.\- ]+(\w|$)/g,((e,t)=>t.toUpperCase()))}_init(){let e={};for(let t=0;t<this.attributes.length;t+=1)e[this._camelize(this.attributes[t].name)]=this.attributes[t].value;let t=["server","type","id","api","auth","auto","lock","name","title","artist","author","url","cover","pic","lyric","lrc"];this.meta={};for(let i of t)this.meta[i]=e[i],delete e[i];this.config=e,this.api=this.meta.api||window.meting_api||"https://music.leonus.cn/?server=:server&type=:type&id=:id&r=:r",this.meta.auto&&this._parse_link()}_parse_link(){let e=[["music.163.com.*song.*id=(\\d+)","netease","song"],["music.163.com.*album.*id=(\\d+)","netease","album"],["music.163.com.*artist.*id=(\\d+)","netease","artist"],["music.163.com.*playlist.*id=(\\d+)","netease","playlist"],["music.163.com.*discover/toplist.*id=(\\d+)","netease","playlist"],["y.qq.com.*song.*/(\\w+)","tencent","song"],["y.qq.com.*song.*?=(\\w+)","tencent","song"],["y.qq.com.*album/(\\w+)","tencent","album"],["y.qq.com.*singer/(\\w+)","tencent","artist"],["y.qq.com.*playsquare/(\\w+)","tencent","playlist"],["y.qq.com.*playlist/(\\w+)","tencent","playlist"],["xiami.com.*song/(\\w+)","xiami","song"],["xiami.com.*album/(\\w+)","xiami","album"],["xiami.com.*artist/(\\w+)","xiami","artist"],["xiami.com.*collect/(\\w+)","xiami","playlist"]];for(let t of e){let e=new RegExp(t[0]).exec(this.meta.auto);if(null!==e)return this.meta.server=t[1],this.meta.type=t[2],void(this.meta.id=e[1])}}_parse(){if(this.meta.url){let e={name:this.meta.name||this.meta.title||"Audio name",artist:this.meta.artist||this.meta.author||"Audio artist",url:this.meta.url,cover:this.meta.cover||this.meta.pic,lrc:this.meta.lrc||this.meta.lyric||"",type:this.meta.type||"auto"};return e.lrc||(this.meta.lrcType=0),this.innerText&&(e.lrc=this.innerText,this.meta.lrcType=2),void this._loadPlayer([e])}let e=this.api.replace(":server",this.meta.server).replace(":type",this.meta.type).replace(":id",this.meta.id).replace(":auth",this.meta.auth).replace(":r",Math.random());fetch(e).then((e=>e.json())).then((e=>this._loadPlayer(e)))}_loadPlayer(e){let t={audio:e,mutex:!0,lrcType:this.meta.lrcType||3,storageName:"metingjs"};if(!e.length)return;let i={...t,...this.config};for(let e in i)"true"!==i[e]&&"false"!==i[e]||(i[e]="true"===i[e]);let a=document.createElement("div");if(i.container=a,this.appendChild(a),this.aplayer=new APlayer(i),document.body.clientWidth>768){let e=document.querySelector("#nav .music-btn");e&&(e.style.display="block")}else{let e=document.querySelector("#sidebar-bottom .music-btn");e&&(e.style.display="flex")}"/zone/"==location.pathname&&waterfall("#talk")}}window.customElements&&!window.customElements.get("meting-js")&&(window.MetingJSElement=MetingJSElement,window.customElements.define("meting-js",MetingJSElement));